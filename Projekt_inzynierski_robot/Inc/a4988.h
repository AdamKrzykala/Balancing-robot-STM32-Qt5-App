/*
 * a4988.h
 *
 *  Created on: 23.04.2019
 *  Author: Michal
 */

#ifndef A4988_H_
#define A4988_H_

#include "gpio.h"
#include "math.h"

/*************************************************************************************************
 *****************			  > A4988_Resolution type definition <			     *****************
 *************************************************************************************************/
typedef enum {

	A4988_Full_step   = 1,
	A4988_One_2_step  = 2,
	A4988_One_4_step  = 4,
	A4988_One_8_step  = 8,
	A4988_One_16_step = 16,

} A4988_Resolution;

/*************************************************************************************************
 *****************			  > A4988_Direction type definition <			     *****************
 *************************************************************************************************/
typedef enum {

	A4988_Left  = 0,
	A4988_Right = 1,

} A4988_Direction;

/*************************************************************************************************
 *****************					  > A4988 structure <				         *****************
 *************************************************************************************************/
struct A4988 {

	GPIO_TypeDef *EN_Port;
	uint16_t	  EN_Pin;

	GPIO_TypeDef *DIR_Port;
	uint16_t 	  DIR_Pin;

	GPIO_TypeDef *MS1_Port;
	uint16_t	  MS1_Pin;

	GPIO_TypeDef *MS2_Port;
	uint16_t	  MS2_Pin;

	GPIO_TypeDef *MS3_Port;
	uint16_t	  MS3_Pin;

	TIM_HandleTypeDef *htim;
	uint32_t tim_channel;

	int 	    Resolution;
	double      Step_angle;
	long int    Steps_per_round;
	long int	Speed_RPM;
	long int 	Step_delay;
};

/*************************************************************************************************
 *****************					> A4988 initialization <			         *****************
 *************************************************************************************************/
void A4988_Init(struct A4988 *a4988,
				TIM_HandleTypeDef *htim, uint32_t tim_channel,
				GPIO_TypeDef *EN_Port,   uint16_t EN_Pin,
				GPIO_TypeDef *DIR_Port,  uint16_t DIR_Pin,
				GPIO_TypeDef *MS1_port,  uint16_t MS1_Pin,
				GPIO_TypeDef *MS2_port,  uint16_t MS2_Pin,
				GPIO_TypeDef *MS3_port,  uint16_t MS3_Pin);

/*************************************************************************************************
 *****************				> A4988 set power on <			         	 	 *****************
 *************************************************************************************************/
void A4988_Power_on(struct A4988 *a4988);

/*************************************************************************************************
 *****************				> A4988 set power off <			         	 	 *****************
 *************************************************************************************************/
void A4988_Power_off(struct A4988 *a4988);

/*************************************************************************************************
 *****************				> A4988 set step resolution <			         *****************
 *************************************************************************************************/
void A4988_Set_Resolution(struct A4988 *a4988, A4988_Resolution resolution);

/*************************************************************************************************
 *****************				> A4988 set rotate direction <			         *****************
 *************************************************************************************************/
void A4988_Set_Direction(struct A4988 *a4988, A4988_Direction direction);

/*************************************************************************************************
 *****************				> A4988 set speed <			         	 		 *****************
 *************************************************************************************************/
void A4988_Set_Speed(struct A4988 *a4988, int speed_rpm);

#endif /* A4988_H_ */
